<nav id="sidebar">
    <h5 class="p-3 mb-0">Categories</h5>
    <input class="searchbar py-2 px-3" [(ngModel)]="categorySearch" placeholder="Filter Categories...">
    <div *ngFor="let category of categories | category:categorySearch"
         class="category py-2 px-3"
         (click)="switchActiveCategory(category)"
         [class.active]="activeCategory === category">{{category.name}}</div>
</nav>

<div id="reporting">
    <div class="mx-3">
        <input class="searchbar w-100 py-2" [(ngModel)]="querySearch" placeholder="Filter Queries...">
    </div>
    <div class="p-3" *ngFor="let category of categories | category:activeCategoryTitle">
        <h4 *ngIf="(category.jobs | category:querySearch).length !== 0" class="report-title">{{category.name}}</h4>

        <div class="accordion rounded mb-3">
            <div class="query" *ngFor="let query of category.jobs | category:querySearch; let first = first; let last = last">
                <div class="title" (click)="switchActiveQuery(query)" [class.rounded-top]="first" [class.rounded-bottom]="last" [class.last-item]="last">
                    <h3 class="py-3 px-4 m-0">{{query.name}}</h3>
                </div>
                <div class="content" *ngIf="activeQuery === query">
                    <div class="row description mx-0">
                        <p class="py-3 px-4 m-0">{{query.description}}</p>
                        <button class="btn btn-primary float-right m-2"
                                (click)="open(content)">Run Query
                        </button>
                    </div>
                    <div class="row report-header run p-2 mx-0">
                        <div class="col-sm-2 border-bar">Date</div>
                        <div class="col-sm-1 border-bar">Issues</div>
                        <div class="col-sm-2 border-bar" *ngFor="let parameter of query.parameterNames">{{parameter}}</div>
                        <div class="col-sm-1 border-bar">User</div>
                        <div class="col-sm-1">Status</div>
                    </div>
                    <div *ngFor="let report of activeReportSet; let last = last" class="row report run p-2 mx-0" [class.last-item]="last">
                        <div class="col-sm-2 border-bar">{{report.requestTime | date:'short'}}</div>
                        <div class="col-sm-1 border-bar">{{report.issuesReported ? report.issuesReported : '0'}}</div>
                        <div class="col-sm-2 border-bar" *ngFor="let item of report.parameters | keyvalue">
                            {{item.value}}
                        </div>
                        <div class="col-sm-1 border-bar">{{report.user}}</div>
                        <div class="col-sm-1" (click)="viewReport(report)" [class.completed]="report.status === 'Complete'">{{report.status}}
                            <i *ngIf="report.status === 'Complete'" class="fas fa-external-link-alt ml-1"></i>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <ng-template #content let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Report Details</h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form>
                <div class="form-group">
                    <div *ngFor="let item of activeQuery.parameterNames; let i = index">
                        <label for="{{item}}" class="col-sm-4">{{item}}</label>
                        <input id="{{item}}" type="text" class="input-border col-sm-8" name="{{item}}" [(ngModel)]="parameters[i]" (input)="typeahead = true">
                        <!--<app-snomed-typeahead *ngIf="typeahead" [input]="parameters[i]" (conceptTypeaheadEmitter)="typeaheadFunc($event, i)"></app-snomed-typeahead>-->
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline-dark" (click)="close('Save click')">Run Report</button>
        </div>
    </ng-template>
</div>


